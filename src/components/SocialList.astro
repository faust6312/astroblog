---
import { Icon } from "astro-icon/components";

interface SocialLink {
    friendlyName: string;
    isWebmention?: boolean;
    link: string;
    name: string;
    type?: 'social' | 'friend';
}

// 将数据移到单独的文件中可以提高组件的可维护性
const socialLinks: SocialLink[] = [
    { friendlyName: "Github", link: "https://github.com/faust6312", name: "mdi:github", type: 'social' },
    { friendlyName: "Bilibili", link: "https://space.bilibili.com/237593169", name: "bilibili", type: 'social' },
    { friendlyName: "Nodeseek", link: "https://www.nodeseek.com/space/24280", name: "nodeseek", type: 'social' },
    { friendlyName: "linux.do", link: "https://linux.do/u/faust6312", name: "linux.do", type: 'social' },
    { friendlyName: "wyy", link: "https://music.163.com/#/user/home?id=449873508", name: "wyy", type: 'social' }
];

const friendLinks: SocialLink[] = [
    { friendlyName: "f6", link: "https://blog.shiyaa.me/", name: "f6", type: 'friend' },
    { friendlyName: "f5", link: "https://blog.noospic.me/", name: "f5", type: 'friend' },
    { friendlyName: "f4", link: "https://blog.wrihope.top/", name: "f4", type: 'friend' },
    { friendlyName: "f3", link: "https://asmrbro.com", name: "f3", type: 'friend' },
    { friendlyName: "f2", link: "https://blog.keepchen.com", name: "f2", type: 'friend' },
    { friendlyName: "f1", link: "https://www.cloudofficial.top", name: "f1", type: 'friend' },
    { friendlyName: "typecho", link: "https://type.700050.xyz/", name: "typecho", type: 'friend' },
    { friendlyName: "cnblog", link: "https://www.cnblogs.com/faust6312", name: "logo", type: 'friend' }
];

// 创建客户端脚本来延迟加载友链图标
const script = `
document.addEventListener('DOMContentLoaded', () => {
    // 初始隐藏友链区域
    const friendLinksContainer = document.getElementById('friend-links-container');
    if (friendLinksContainer) {
        friendLinksContainer.style.display = 'none';
    }

    // 添加友链切换按钮的点击事件
    const toggleBtn = document.getElementById('toggle-friend-links');
    if (toggleBtn && friendLinksContainer) {
        toggleBtn.addEventListener('click', () => {
            if (friendLinksContainer.style.display === 'none') {
                friendLinksContainer.style.display = 'flex';
                toggleBtn.textContent = '隐藏友链';
            } else {
                friendLinksContainer.style.display = 'none';
                toggleBtn.textContent = '显示友链';
            }
        });
    }
});
`;
---

<div class="mt-8 flex min-h-[64px] flex-col gap-y-4">
    <!-- 社交链接 - 保持直接加载，因为这些是主要链接 -->
    <div class="flex flex-wrap items-end justify-end gap-x-2 text-right">
        <ul class="flex flex-1 flex-wrap items-center gap-2 sm:flex-initial">
            {socialLinks.map((link) => (
                <li class="h-8 w-8">
                    <a
                        class="inline-flex h-full w-full items-center justify-center sm:hover:text-link"
                        href={link.link}
                        rel={`noreferrer ${link.isWebmention ? "me authn" : ""}`}
                        target="_blank"
                        aria-label={link.friendlyName}
                    >
                        <Icon 
                            aria-hidden="true" 
                            class="h-full w-full" 
                            focusable="false" 
                            name={link.name} 
                            loading="lazy" 
                            width="24"
                            height="24"
                        />
                    </a>
                </li>
            ))}
        </ul>
    </div>

    <!-- 友情链接 - 采用按需加载方式 -->
    {friendLinks.length > 0 && (
        <>
            <div class="w-full text-right">
                <button id="toggle-friend-links" class="px-2 py-1 text-sm font-bold text-gray-600 hover:text-gray-800">
                    显示友链
                </button>
            </div>
            <div id="friend-links-container" class="flex flex-wrap items-end justify-end gap-x-2 text-right">
                <ul class="flex flex-1 flex-wrap items-center gap-2 sm:flex-initial">
                    {friendLinks.map((link) => (
                        <li class="h-8 w-8">
                            <a
                                class="inline-flex h-full w-full items-center justify-center sm:hover:text-link"
                                href={link.link}
                                rel={`noreferrer ${link.isWebmention ? "me authn" : ""}`}
                                target="_blank"
                                aria-label={link.friendlyName}
                            >
                                <Icon 
                                    aria-hidden="true" 
                                    class="h-full w-full" 
                                    focusable="false" 
                                    name={link.name} 
                                    loading="lazy" 
                                    width="24"
                                    height="24"
                                />
                            </a>
                        </li>
                    ))}
                </ul>
            </div>
        </>
    )}
</div>

<!-- 内联脚本以优化加载性能 -->
<script set:html={script}></script>
